<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>パチンコゲーム</title>
	<link rel="stylesheet" href="style.css">
	<!-- Embed slot styles so injected slot markup is styled correctly -->
	<link rel="stylesheet" href="../GAME-SLOT-1/style.css">
	<!-- Pachinko scope override: hide slot's manual stop buttons (目押しボタン) when embedded -->
	<style>
		/* パチンコ画面ではスロットの目押しボタンは使用しないため非表示 */
		#embedded-slot-area .manual-controls {
			display: none !important;
		}

		/* 埋め込みスロットの配置を「スロット本体の下にスタートボタン」、かつ左右中央に固定 */
		#embedded-slot-area {
			display: block;
		}

		#embedded-slot-area #embedded-slot-container {
			display: flex;
			flex-direction: column;
			align-items: center;
			/* 左右中央揃え */
			justify-content: flex-start;
			gap: 10px;
			/* スロットとボタンの間隔 */
		}

		/* スロット本体を中央寄せ */
		#embedded-slot-area #slot-machine {
			margin: 0 auto;
		}

		/* スタートボタンは必ずスロットの下・中央に表示 */
		#embedded-slot-area #actionBtn {
			align-self: center !important;
			position: static !important;
			float: none !important;
			margin: 0;
			/* gapで調整するため */
			display: inline-flex;
			align-items: center;
			gap: 6px;
		}

		/* パチンコ画面ではスロットの勝利オーバーレイを表示しない */
		#embedded-slot-area #winMessage {
			display: none !important;
		}

		/* ポータルへ戻るボタン（ページ上部で目立ちすぎないボタン） */
		.topbar {
			position: sticky;
			top: 8px;
			z-index: 100;
			display: flex;
			justify-content: flex-start;
			margin: 8px 0;
		}

		.back-to-portal {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			padding: 6px 10px;
			border-radius: 6px;
			text-decoration: none;
			background: #f5f5f5;
			color: #333;
			border: 1px solid #ddd;
			box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
		}

		@media (prefers-color-scheme: dark) {
			.back-to-portal {
				background: #2b2b2b;
				color: #eee;
				border-color: #444;
			}
		}
	</style>
</head>

<body>
	<!-- Portal Back Button -->
	<div class="topbar">
		<a class="back-to-portal" href="../index.html" aria-label="ポータルに戻る">← ポータルに戻る</a>
	</div>
	<!-- ゲームタイトル -->
	<h1></h1>

	<!-- Matter.jsのレンダリングが行われるコンテナ -->
	<div id="game-container"></div>

	<!-- ボールの発射方向を示す矢印 -->
	<div id="launch-arrow" aria-hidden="true"></div>

	<!-- ゲームの操作パネル -->
	<div class="controls">
		<!-- 発射強度を調整するスライダー -->
		<input id="speed-slider" type="range" min="0" max="100" step="1" value="50">
		<div class="slider-info">
			<label>強さ (0〜100): <span id="speed-val">50</span></label>
		</div>

		<!-- Embedded slot area: 開発者パネルより上に配置するため、.controls 内に置く -->
		<div id="embedded-slot-area" style="margin-top:12px;z-index:50;display:block;">
			<!-- Slot HTML will be injected here when adapter initializes -->
			<div id="embedded-slot-container"></div>
		</div>
	</div>

	<!-- 物理エンジンライブラリ -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
	<!-- 凹多角形の分解ライブラリ（Matter.jsのBodies.fromVerticesで必要） -->
	<script src="https://cdn.jsdelivr.net/npm/poly-decomp@0.3.0/build/decomp.min.js"></script>

	<!-- poly-decompをMatter.jsに登録 -->
	<script>
		(function () {
			var ok = false;
			// ライブラリが正しく読み込まれているか確認
			if (window.decomp && window.Matter && window.Matter.Common) {
				// 凹多角形を扱えるように設定
				window.Matter.Common.setDecomp(window.decomp);
				ok = true;
			}
			if (!ok) {
				console.warn('[topPlate] poly-decomp の登録に失敗しました。複雑な頂点形状が凸包化される可能性があります。');
			}
		})();
	</script>

	<!-- ゲームスクリプト（読み込み順序が重要） -->
	<script src="js/config.js"></script> <!-- 設定ファイル -->
	<script src="js/objects.js"></script> <!-- ゲームオブジェクト定義 -->
	<script src="js/dev-tools.js"></script> <!-- 開発用ツール -->
	<script src="js/main.js"></script> <!-- メインロジック -->
	<!-- Slot adapter (optional embedding of GAME-SLOT-1) -->
	<script src="../GAME-SLOT-1/config.js"></script>
	<!-- New: slot audio manager must be loaded before script.js to enable sounds -->
	<script src="../GAME-SLOT-1/audio.js"></script>
	<script src="../GAME-SLOT-1/script.js"></script>
	<script src="js/slot-adapter.js"></script>
</body>

</html>